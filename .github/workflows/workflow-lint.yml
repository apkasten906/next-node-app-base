name: Workflow Lint

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  actionlint:
    name: Workflow Lint (actionlint)
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4

      - name: Install actionlint
        run: |
          set -euo pipefail

          version="1.7.10"
          tarball="actionlint_${version}_linux_amd64.tar.gz"
          checksums="actionlint_${version}_checksums.txt"

          curl -fsSL -o "$tarball" "https://github.com/rhysd/actionlint/releases/download/v${version}/${tarball}"
          curl -fsSL -o "$checksums" "https://github.com/rhysd/actionlint/releases/download/v${version}/${checksums}"

          expected_sha256="$(awk -v f="$tarball" '$2==f {print $1; exit}' "$checksums")"
          if [ -z "$expected_sha256" ]; then
            echo "Could not find SHA256 for $tarball in $checksums" >&2
            head -n 50 "$checksums" >&2 || true
            exit 1
          fi
          echo "${expected_sha256}  ${tarball}" | sha256sum -c -

          tar -xzf "$tarball" actionlint
          sudo mv actionlint /usr/local/bin/actionlint

          actionlint -version

      - name: Lint workflows
        run: actionlint
